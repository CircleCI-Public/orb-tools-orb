description: |
  Publishes the current packed orb source as a dev version to two dev tags,"dev:alpha" and "dev:xxxxxxx" first 7 characters of the commit SHA are used.
  Expects the packed orb source to be provided via "workspace" generated by the "pack" job.

executor: cli/default

parameters:
  orb-dir:
    description: Directory containing packed orb source. Path must be absolute or relative to the working directory. Should match the "output-dir" of the "pack" job.
    type: string
    default: ./dist/

  orb-name:
    type: string
    description: >
      The versionless orb slug, e.g. "circleci/orb-tools"

  publish-token-variable:
    type: env_var_name
    default: CIRCLE_TOKEN
    description: >
      Name of environment variable containing your CircleCI API token.

steps:
  - attach_workspace:
      at: <<parameters.orb-dir>>
  - run:
      name: Publishing Orb Dev Version
      environment:
        ORB_PARAM_ORB_DIR: <<parameters.orb-dir>>
        ORB_PARAM_ORB_NAME: <<parameters.orb-name>>
        ORB_PARAM_ORB_PUB_TOKEN: <<parameters.publish-token-variable>>
      command: <<include(scripts/publish-dev.sh)>>
